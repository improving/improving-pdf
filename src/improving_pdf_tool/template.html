<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{TITLE}}</title>
    <style>
        :root {
            --improving-blue: #0054a6;
            --improving-teal: #0097a7;
            --improving-light-blue: #e8f4fc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            color: #444;
            background: white;
        }

        /* Base H1 style (fallback) */
        .content h1 {
            color: var(--improving-blue);
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.2;
            margin: 0 0 1rem 0;
        }

        /* Document title (H1) - large bold blue */
        .content .doc-title {
            color: var(--improving-blue);
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
            margin: 0 0 0.25rem 0;
            text-transform: none;
        }

        /* Subtitle (first H2 after H1) - teal tagline, overrides block styling */
        .content .doc-subtitle {
            color: var(--improving-teal) !important;
            font-size: 1.25rem !important;
            font-weight: 400 !important;
            margin: 0 0 1.5rem 0 !important;
            text-transform: none !important;
            background: none !important;
            background-image: none !important;
            padding: 0 !important;
            letter-spacing: normal !important;
        }

        /* Section headers (H2) - gradient background image, stretched horizontally, tiled vertically */
        .content h2 {
            position: relative;
            color: white;
            font-size: 1.25rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            margin: 1.5rem 0 0.75rem 0;
            padding: 0.9rem 1.125rem 0.9rem 1.125rem;
            background-image: url('{{H2_BACKGROUND_IMG}}');
            background-color: var(--improving-blue);
            background-repeat: repeat-y;
            background-size: 100% auto;
            background-position: left top;
        }

        .content h3 {
            color: var(--improving-teal);
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-top: 1.25rem;
            margin-bottom: 0.4rem;
        }

        .content h4 {
            color: #444;
            font-size: 0.75rem;
            font-weight: 700;
            margin-top: 1rem;
            margin-bottom: 0.3rem;
        }

        .content p {
            color: #444;
            font-size: 0.75rem;
            line-height: 1.7;
            margin-bottom: 0.75rem;
            text-align: left;
        }

        .content ul, .content ol {
            margin-left: 1rem;
            margin-bottom: 0.75rem;
        }

        .content li {
            color: #444;
            font-size: 0.75rem;
            line-height: 1.6;
            margin-bottom: 0.4rem;
        }

        .content li strong {
            color: #333;
        }

        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.7rem;
        }

        .content th {
            background-color: var(--improving-blue);
            color: white;
            padding: 0.5rem;
            text-align: left;
            font-weight: 600;
        }

        .content td {
            padding: 0.4rem 0.5rem;
            border-bottom: 1px solid #e5e5e5;
            color: #444;
        }

        .content tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .content code {
            background-color: #f4f4f4;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-size: 0.7rem;
        }

        .content pre {
            background-color: #f4f4f4;
            padding: 0.75rem;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 0.65rem;
            margin: 0.75rem 0;
        }

        .content pre code {
            background: none;
            padding: 0;
        }

        .content blockquote {
            border-left: 3px solid var(--improving-teal);
            padding-left: 1rem;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
        }

        .content hr {
            border: none;
            border-top: 1px solid #e5e5e5;
            margin: 1.5rem 0;
        }

        .content .mermaid-figure {
            margin: 1rem 0;
            page-break-inside: avoid;
        }

        .content .mermaid-img {
            max-width: 100%;
            max-height: 6in;
            object-fit: contain;
            display: block;
            margin: 0.5rem auto;
        }

        /* Screen preview styles */
        @media screen {
            body {
                background: #e5e7eb;
                padding: 2rem 0;
            }
            .screen-page {
                max-width: 8.5in;
                margin: 0 auto 2rem auto;
                background: white;
                box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
                position: relative;
                overflow: hidden;
            }
            .screen-header img, .screen-footer img {
                width: 100%;
                height: auto;
                display: block;
            }
            .screen-content {
                padding: 1.5rem 2.5rem;
            }
            .page-bg-decoration-screen {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 200px;
                background-image: url('{{BG_DECORATION_IMG}}');
                background-repeat: repeat-x;
                background-position: left bottom;
                background-size: auto 100%;
                opacity: 0.5;
                pointer-events: none;
                z-index: 1;
            }
            .screen-footer {
                position: relative;
                z-index: 2;
            }
            .footer-copyright {
                position: absolute;
                bottom: 8px;
                left: 16px;
                font-size: 9px;
                color: var(--improving-blue);
                font-family: 'Segoe UI', Arial, sans-serif;
                z-index: 3;
            }
            .screen-content-wrapper {
                position: relative;
                z-index: 3;
            }
            /* Hide print-only elements on screen */
            .print-table { display: none; }
            .print-footer { display: none; }
            .page-bg-decoration-print { display: none; }
        }

        /* Print styles */
        @media print {
            @page {
                size: letter;
                margin: 0;
            }
            body {
                margin: 0;
                padding: 0;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            /* Header repeats via table thead */
            .print-table {
                width: 100%;
                border-collapse: collapse;
            }
            .print-table thead { display: table-header-group; }
            .print-table tfoot { display: table-footer-group; }
            .print-spacer { height: 50px; }
            .print-table tbody { display: table-row-group; }
            .print-table thead img {
                width: 100%;
                height: auto;
                display: block;
            }

            /* Fixed footer at bottom of every printed page */
            .print-footer {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                z-index: 2;
            }
            .print-footer .footer-copyright {
                position: absolute;
                bottom: 8px;
                left: 16px;
                font-size: 9px;
                color: var(--improving-blue);
                font-family: 'Segoe UI', Arial, sans-serif;
                z-index: 3;
            }
            .print-footer img {
                width: 100%;
                height: auto;
                display: block;
                padding-top: 20px;
            }

            /* Add padding to content cell */
            .print-content-cell {
                padding-top: 24px !important;
            }

            /* Ensure thead cells have bottom spacing so content doesn't touch header */
            .print-table thead td {
                padding-bottom: 20px;
            }

            /* Prevent breaks inside elements */
            .content h1, .content h2, .content h3, .content h4 { page-break-after: avoid; }
            .content p, .content li { page-break-inside: avoid; }
            .content table { page-break-inside: avoid; }
            .content pre { page-break-inside: avoid; }

            /* Hide screen-only elements */
            .screen-page { display: none; }

            /* Show print elements */
            .print-table { display: table; }
            .print-footer { display: block; }

            /* Background decoration fixed at bottom of each page */
            .page-bg-decoration-print {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                height: 200px;
                background-image: url('{{BG_DECORATION_IMG}}');
                background-repeat: repeat-x;
                background-position: left bottom;
                background-size: auto 100%;
                opacity: 0.5;
                z-index: -1;
            }
        }
    </style>
    {{MERMAID_SCRIPT}}
</head>
<body>
    <!-- Screen Preview (visible only on screen, hidden when printing) -->
    <div class="screen-page">
        <div class="screen-header">
            <img src="{{HEADER_IMG}}" alt="Header">
        </div>
        <div class="screen-content-wrapper">
            <div class="screen-content content">
                {{CONTENT}}
            </div>
        </div>
        <div class="screen-footer">
            <img src="{{FOOTER_IMG}}" alt="Footer">
            <span class="footer-copyright">© {{YEAR}} Improving</span>
        </div>
        <div class="page-bg-decoration-screen"></div>
    </div>

    <!-- Print Layout (table-based for repeating header, fixed footer) -->
    <table class="print-table">
        <thead>
            <tr><td><img src="{{HEADER_IMG}}" alt="Header"></td></tr>
        </thead>
        <tfoot>
            <tr><td class="print-spacer"></td></tr>
        </tfoot>
        <tbody>
            <tr><td class="content print-content-cell content-wrapper" style="padding-left: 2.5rem; padding-right: 2.5rem; padding-top: 1.5rem; padding-bottom: 1.5rem;">{{CONTENT}}</td></tr>
        </tbody>
    </table>

    <!-- Fixed footer appears at bottom of every printed page -->
    <div class="print-footer">
        <img src="{{FOOTER_IMG}}" alt="Footer">
        <span class="footer-copyright">© {{YEAR}} Improving</span>
    </div>

    <!-- Background decoration for print (fixed at bottom of each page, under footer) -->
    <div class="page-bg-decoration-print"></div>
</body>
</html>
